<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dash board | landing</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <!-- Estilos personalizados -->
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f0f2f5;
      }
      .navbar-brand {
        font-weight: 700;
        font-size: 1.6rem;
      }
      .hero-section {
        background: linear-gradient(to right, #0f2027, #203a43, #2c5364);
        color: white;
        padding: 100px 0;
        text-align: center;
      }
      .hero-section h1 {
        font-size: 3rem;
        font-weight: bold;
      }
      .hero-section p {
        font-size: 1.2rem;
        opacity: 0.9;
      }
      .features-section,
      .why-section,
      .cta-section {
        padding: 60px 0;
      }
      .features-section h2,
      .why-section h2,
      .cta-section h2 {
        color: #2c5364;
        font-weight: 700;
        margin-bottom: 30px;
      }
      .feature-icon {
        font-size: 2.5rem;
        color: #2c5364;
        margin-bottom: 15px;
      }
      .cta-button {
        background-color: #203a43;
        border: none;
        padding: 15px 30px;
        font-size: 1.2rem;
        color: #fff;
        border-radius: 8px;
        transition: background 0.3s ease;
      }
      .cta-button:hover {
        background-color: #1a2e35;
      }
      footer {
        background-color: #1a2e35;
        color: white;
        padding: 20px 0;
        text-align: center;
      }
      footer a {
        color: #79c2d0;
        text-decoration: none;
      }
      footer a:hover {
        text-decoration: underline;
      }
      .user-icon {
        cursor: pointer;
        font-size: 1.5rem;
        margin-left: 10px;
      }
      .error-message {
        color: red;
        font-size: 0.9rem;
        margin-top: 5px;
      }
      .nav-link-custom {
        cursor: pointer;
        color: #2c5364;
        text-decoration: none;
      }
      .nav-link-custom:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container">
        <a class="navbar-brand" href="">dashManagement</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="#">Inicio</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#features">Características</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#why">¿Por qué elegirnos?</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#cta">Probar ahora</a>
            </li>
            <!-- Enlace de Registrarse -->
            <li class="nav-item">
              <a
                id="register-link"
                class="nav-link nav-link-custom"
                href="/landing/form"
              >
                log-in/sing-up
              </a>
            </li>
            <!-- Enlace de Iniciar Sesión o Icono de Usuario -->
            <li class="nav-item">
              <div id="user-section">

                <!-- Si el usuario está logueado, mostrar icono de usuario -->
                <span id="user-icon" class="user-icon" style="display: none;">
                  <i class="bi bi-person-circle" data-bs-toggle="modal" data-bs-target="#profileModal"></i>
                </span>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Modal de Log-in -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="loginModalLabel">Iniciar Sesión</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="loginForm">
              <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" required />
              </div>
              <div class="mb-3">
                <label for="password" class="form-label">Contraseña</label>
                <input type="password" class="form-control" id="password" required />
              </div>
              <div id="loginError" class="error-message" style="display: none;">Correo o contraseña incorrectos.</div>
              <button type="submit" class="btn btn-success">Iniciar Sesión</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal de Perfil -->
    <div class="modal fade" id="profileModal" tabindex="-1" aria-labelledby="profileModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="profileModalLabel">Perfil de Usuario</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p><strong>Nombre:</strong> <span id="profileName"></span></p>
            <p><strong>Email:</strong> <span id="profileEmail"></span></p>
            <button id="editProfileBtn" class="btn btn-primary">Editar Perfil</button>
            <button id="deleteProfileBtn" class="btn btn-danger">Borrar Perfil</button>
            <button id="logoutBtn" class="btn btn-warning">Cerrar Sesión</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Hero Section -->
    <section class="hero-section">
      <div class="container">
        <h1>¡Organiza tus recetas e insumos de forma fácil y GRATIS!</h1>
        <p>
          Todo lo que necesitas para gestionar tus recetas y controlar tus
          insumos, en un solo lugar.
        </p>
        <button id="cta-button" class="btn btn-lg cta-button">Probar ahora</button>
      </div>
    </section>

<!-- Features Section -->
<section id="features" class="features-section">
  <div class="container">
    <h2>¿Qué ofrece nuestra app?</h2>
    <div class="row">
      <div class="col-md-3 text-center">
        <div class="feature-icon"><i class="bi bi-journal-text"></i></div>
        <h4>Guarda tus recetas</h4>
        <p>Accede a tus recetas favoritas en segundos.</p>
      </div>
      <div class="col-md-3 text-center">
        <div class="feature-icon"><i class="bi bi-basket"></i></div>
        <h4>Controla tus insumos</h4>
        <p>Agrega, actualiza o elimina ingredientes fácilmente.</p>
      </div>
      <div class="col-md-3 text-center">
        <div class="feature-icon"><i class="bi bi-ui-checks"></i></div>
        <h4>Interfaz fácil</h4>
        <p>Diseñada para que cualquiera pueda usarla.</p>
      </div>
      <div class="col-md-3 text-center">
        <div class="feature-icon"><i class="bi bi-cloud-check"></i></div>
        <h4>Acceso inmediato</h4>
        <p>Tus datos siempre están disponibles.</p>
      </div>
      <div class="col-md-3 text-center">
        <div class="feature-icon"><i class="bi bi-cash-coin"></i></div>
        <h4>Control de gastos</h4>
        <p>Tus gastos siempre disponibles y controlados.</p>
      </div>
    </div>
  </div>
</section>


    <!-- Why Section -->
    <section id="why" class="why-section bg-light">
      <div class="container">
        <h2>¿Por qué probarla?</h2>
        <div class="row">
          <div class="col-md-4 text-center">
            <h4>Totalmente gratis</h4>
            <p>Sin costos ocultos ni suscripciones.</p>
          </div>
          <div class="col-md-4 text-center">
            <h4>Fácil y rápido</h4>
            <p>Empieza a usarla en menos de un minuto.</p>
          </div>
          <div class="col-md-4 text-center">
            <h4>Accesible siempre</h4>
            <p>Tus datos siempre están a tu alcance.</p>
          </div>
        </div>
        <div class="col-md-4 text-center">
          <h4>Menos riesgo de perder tus recetas.</h4>
          <p>Más accesible y controlable.</p>
        </div>
      </div>
    </section>

 

    <!-- Footer -->
    <footer>
      <div class="container">
        <p>
          ¿Preguntas? Contáctanos en
          <a href="#">Discord - Cherry's</a>
        </p>
        <p>© 2025 dashManagement. Todos los derechos reservados.</p>
      </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Script para manejar IndexedDB -->
    <script>
      let db;
      const dbName = 'UserDB';
      const storeName = 'users';

      // Abrir o crear la base de datos
      const request = indexedDB.open(dbName, 1);

      request.onupgradeneeded = (event) => {
        db = event.target.result;
        if (!db.objectStoreNames.contains(storeName)) {
          db.createObjectStore(storeName, { keyPath: 'email' });
        }
      };

      request.onsuccess = (event) => {
        db = event.target.result;
        checkUserLoggedIn();
      };

      request.onerror = (event) => {
        console.error('Error al abrir IndexedDB:', event.target.error);
      };

      // Guardar usuario en IndexedDB
      function saveUser(user) {
        const transaction = db.transaction([storeName], 'readwrite');
        const store = transaction.objectStore(storeName);
        const request = store.add(user);

        request.onsuccess = () => {
          console.log('Usuario guardado en IndexedDB');
          showUserIcon(user);
          // Redirigir automáticamente después de iniciar sesión
          window.location.href = "/";
        };

        request.onerror = (event) => {
          if (event.target.error.name === 'ConstraintError') {
            alert('El correo ya está registrado.');
          } else {
            console.error('Error al guardar el usuario:', event.target.error);
          }
        };
      }

      // Obtener usuario de IndexedDB
      function getUser(email, callback) {
        const transaction = db.transaction([storeName], 'readonly');
        const store = transaction.objectStore(storeName);
        const request = store.get(email);

        request.onsuccess = () => {
          callback(request.result);
        };

        request.onerror = (event) => {
          console.error('Error al obtener el usuario:', event.target.error);
        };
      }

      // Eliminar usuario de IndexedDB
      function deleteUser(email) {
        const transaction = db.transaction([storeName], 'readwrite');
        const store = transaction.objectStore(storeName);
        const request = store.delete(email);

        request.onsuccess = () => {
          console.log('Usuario eliminado de IndexedDB');
          hideUserIcon();
        };

        request.onerror = (event) => {
          console.error('Error al eliminar el usuario:', event.target.error);
        };
      }

      // Verificar si hay un usuario logueado al cargar la página
      function checkUserLoggedIn() {
        const transaction = db.transaction([storeName], 'readonly');
        const store = transaction.objectStore(storeName);
        const request = store.getAll();

        request.onsuccess = () => {
          if (request.result.length > 0) {
            const user = request.result[0];
            showUserIcon(user);
          }
        };
      }

      // Mostrar icono de usuario y datos
      function showUserIcon(user) {
        const userIcon = document.getElementById('user-icon');
        userIcon.style.display = 'inline-block';
        document.getElementById('profileName').textContent = user.name;
        document.getElementById('profileEmail').textContent = user.email;
        document.getElementById('login-link').style.display = 'none';
      }

      // Ocultar icono de usuario
      function hideUserIcon() {
        const userIcon = document.getElementById('user-icon');
        userIcon.style.display = 'none';
        document.getElementById('login-link').style.display = 'inline-block';
      }

      // Manejar el inicio de sesión
      document.getElementById('loginForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;

        getUser(email, (user) => {
          if (user && user.password === password) {
            showUserIcon(user);
            const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
            loginModal.hide();
            // Redirigir automáticamente después de iniciar sesión
            window.location.href = "/";
          } else {
            document.getElementById('loginError').style.display = 'block';
          }
        });
      });

      // Manejar el botón CTA
      document.getElementById('cta-button').addEventListener('click', () => {
        const transaction = db.transaction([storeName], 'readonly');
        const store = transaction.objectStore(storeName);
        const request = store.getAll();

        request.onsuccess = () => {
          if (request.result.length > 0) {
            // Si hay un usuario registrado, redirigir a "/"
            window.location.href = "/";
          } else {
            // Si no hay un usuario registrado, redirigir a "/landing/form"
            window.location.href = "/landing/form";
          }
        };
      });
    </script>
  </body>
</html>